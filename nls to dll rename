


# Administrator privilege check
if (-NOT ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {
    Write-Error "This script requires Administrator privileges. Please run PowerShell as Administrator."
    exit 1
}

# System32 directory path
$system32Path = "$env:windir\System32"

# File paths
$taskhostExe = Join-Path $system32Path "taskhost.nls"
$taskhostDll = Join-Path $system32Path "taskhost.dll"

# Check if taskhost.nls exists
if (-NOT (Test-Path $taskhostExe)) {
    Write-Error "taskhost.nls not found in System32 directory."
    exit 1
}

# Check if taskhost.dll already exists
if (Test-Path $taskhostDll) {
    Write-Warning "taskhost.dll already exists. Do you want to overwrite it?"
    $confirmation = Read-Host "Continue? (y/n)"
    if ($confirmation -ne 'y') {
        Write-Host "Operation cancelled."
        exit 0
    }
}

try {
    # Take ownership and set permissions
    Write-Host "Taking ownership of taskhost.nls..."
    takeown /f $taskhostExe /A
    icacls $taskhostExe /grant administrators:F
    
    # Rename the file
    Write-Host "Renaming taskhost.nls to taskhost.dll..."
    Rename-Item -Path $taskhostExe -NewName "taskhost.dll" -Force
    
    Write-Host "Successfully renamed taskhost.nls to taskhost.dll" -ForegroundColor Green
}
catch {
    Write-Error "Error occurred: $_"
    Write-Host "Failed to rename taskhost.nls" -ForegroundColor Red
}
